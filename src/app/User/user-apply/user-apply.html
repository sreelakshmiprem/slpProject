<div class="apply-job-container">
  <app-header></app-header>

  <div class="content">
    <app-sidebar></app-sidebar>

    <main class="main-content">
      <h2 class="title">Apply for Job</h2>

      <form [formGroup]="applyForm" (ngSubmit)="onSubmit()">

        <div class="form-group">
          <label>Full Name</label>
          <input type="text" formControlName="fullName" placeholder="Enter your full name" maxlength=50 />
          @if (applyForm.get('fullName')?.touched && applyForm.get('fullName')?.hasError('required')) {
          <div class="error">
            Full Name is required.
          </div>
          }
        </div>

        <div class="form-group">
          <label>Email</label>
          <input type="email" formControlName="email" readonly />
        </div>


        <div class="form-group">
          <label>Years of Experience</label>
          <input type="number" formControlName="yearsOfExperience" min="0" max="50" />
          @if (applyForm.get('yearsOfExperience')?.touched && applyForm.get('yearsOfExperience')?.hasError('required'))
          {
          <div class="error">
            Years of Experience is required.
          </div>
          }
          @if (applyForm.get('yearsOfExperience')?.touched && applyForm.get('yearsOfExperience')?.hasError('min')) {
          <div class="error">
            Must be 0 or greater.
          </div>
          }
          @if (applyForm.get('yearsOfExperience')?.touched && applyForm.get('yearsOfExperience')?.hasError('max')) {
          <div class="error">
            Maximum year of experience accepted is 50!.
          </div>
          }
        </div>

        <div class="form-group">
          <label>Resume</label>
          <input type="file" (change)="onFileChange($event)" />
          @if (!resumeFile && isSubmitting) {
          <div class="error">
            Resume is required.
          </div>
          }
        </div>

        <div class="form-group">
          <label>Job</label>
          <select formControlName="jobId">
            <option value="" disabled>Select a job</option>
            @for (job of jobs; track job.jobId) {
            <option [value]="job.jobId">{{ job.jobTitle }}</option>
            }
          </select>
          @if (applyForm.get('jobId')?.touched && applyForm.get('jobId')?.hasError('required')) {
          <div class="error">
            Job selection is required.
          </div>
          }
        </div>

        <div class="form-group">
          <label>Skills (select multiple)</label>
          <select formControlName="skills" multiple size="5">
            @for (skill of masterSkills; track skill.masterSkillId) {
            <option [value]="skill.masterSkillId">{{ skill.skillName }}</option>
            }
          </select>
          @if (applyForm.get('skills')?.touched && applyForm.get('skills')?.hasError('required')) {
          <div class="error">
            At least one skill is required.
          </div>
          }
        </div>


        @if (applyForm.get('skills')?.value?.length > 0) {
        <div class="selected-skills">
          @for (skillId of applyForm.get('skills')?.value; track skillId) {
          <span class="skill-chip">
            {{ getSkillName(skillId) }}
            <button type="button" (click)="removeSkill(skillId)">Ã—</button>
          </span>
          }
        </div>
        }

        <button type="submit" class="btn-submit" [disabled]="isSubmitting || !applyForm.valid || !resumeFile">
          {{ isSubmitting ? 'Submitting...' : 'Apply Now' }}
        </button>
      </form>
    </main>
  </div>

  <app-footer></app-footer>
</div>